<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="next-config" data-name="main" type="application/json">{&quot;hostname&quot;:&quot;example.com&quot;,&quot;root&quot;:&quot;&#x2F;&quot;,&quot;images&quot;:&quot;&#x2F;images&quot;,&quot;scheme&quot;:&quot;Muse&quot;,&quot;version&quot;:&quot;8.3.0&quot;,&quot;exturl&quot;:false,&quot;sidebar&quot;:{&quot;position&quot;:&quot;left&quot;,&quot;display&quot;:&quot;post&quot;,&quot;padding&quot;:18,&quot;offset&quot;:12},&quot;copycode&quot;:false,&quot;bookmark&quot;:{&quot;enable&quot;:false,&quot;color&quot;:&quot;#222&quot;,&quot;save&quot;:&quot;auto&quot;},&quot;fancybox&quot;:false,&quot;mediumzoom&quot;:false,&quot;lazyload&quot;:false,&quot;pangu&quot;:false,&quot;comments&quot;:{&quot;style&quot;:&quot;tabs&quot;,&quot;active&quot;:null,&quot;storage&quot;:true,&quot;lazyload&quot;:false,&quot;nav&quot;:null},&quot;motion&quot;:{&quot;enable&quot;:true,&quot;async&quot;:false,&quot;transition&quot;:{&quot;post_block&quot;:&quot;fadeIn&quot;,&quot;post_header&quot;:&quot;fadeInDown&quot;,&quot;post_body&quot;:&quot;fadeInDown&quot;,&quot;coll_header&quot;:&quot;fadeInLeft&quot;,&quot;sidebar&quot;:&quot;fadeInUp&quot;}},&quot;prism&quot;:false,&quot;i18n&quot;:{&quot;placeholder&quot;:&quot;搜索...&quot;,&quot;empty&quot;:&quot;没有找到任何搜索结果：${query}&quot;,&quot;hits_time&quot;:&quot;找到 ${hits} 个搜索结果（用时 ${time} 毫秒）&quot;,&quot;hits&quot;:&quot;找到 ${hits} 个搜索结果&quot;}}</script>
<meta name="description" content="当你下定决心做一件事的时候，全世界都会来帮你">
<meta property="og:type" content="website">
<meta property="og:title" content="一叶的小窝">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="一叶的小窝">
<meta property="og:description" content="当你下定决心做一件事的时候，全世界都会来帮你">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="一叶">
<meta property="article:tag" content="逆向">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/">



<script class="next-config" data-name="page" type="application/json">{&quot;sidebar&quot;:&quot;&quot;,&quot;isHome&quot;:true,&quot;isPost&quot;:false,&quot;lang&quot;:&quot;zh-CN&quot;,&quot;comments&quot;:&quot;&quot;,&quot;permalink&quot;:&quot;&quot;,&quot;path&quot;:&quot;index.html&quot;,&quot;title&quot;:&quot;&quot;}</script>

<script class="next-config" data-name="calendar" type="application/json">&quot;&quot;</script>
<title>一叶的小窝</title><script src="/js/config.js"></script>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">一叶的小窝</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Keep on going never give up</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section">首页</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives" rel="section">归档</a></li>
        <li class="menu-item menu-item-about"><a href="/about" rel="section">关于</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories" rel="section">分类</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags" rel="section">标签</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">一叶</p>
  <div class="site-description" itemprop="description">当你下定决心做一件事的时候，全世界都会来帮你</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
        
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/02/Android%E7%AC%94%E8%AE%B0-%E4%B8%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="一叶">
      <meta itemprop="description" content="当你下定决心做一件事的时候，全世界都会来帮你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一叶的小窝">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/02/Android%E7%AC%94%E8%AE%B0-%E4%B8%80/" class="post-title-link" itemprop="url">Android笔记(一)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-12-02 17:19:17" itemprop="dateCreated datePublished" datetime="2021-12-02T17:19:17+08:00">2021-12-02</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-12-23 21:44:16" itemprop="dateModified" datetime="2021-12-23T21:44:16+08:00">2021-12-23</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Android 小白的入门之旅。</p>
<p>转载、整理一些基础知识点系列。</p>
<hr>
<h2 id="Android-虚拟机"><a href="#Android-虚拟机" class="headerlink" title="Android 虚拟机"></a>Android 虚拟机</h2><p>Android虚拟机包含 <code>Dalvik虚拟机</code> (DVM)、 <code>ART</code> （Android Runtime）。</p>
<p> <code>Android</code> 应用程序运行在 <code>Dalvik/ART</code> 虚拟机，并且每一个应用程序对应有一个单独的 <code>Dalvik</code> 虚拟机实例。<br> <code>Dalvik</code> 虚拟机实则也算是一个 <code>Java</code> 虚拟机（JVM），只不过它执行的是 <code>dex</code>文件，而不是 <code>class</code> 文件。</p>
<p><code>Dalvik</code> 虚拟机执行的是 <code>dex</code> 字节码，从 <code>Android2.2</code> 版本开始，支持 JIT即时编译 (Just in Time)，在程序运行的过程中进行选择热点代码(经常执行的代码)进行编译或者优化。</p>
<p>而 <code>ART(Android RunTime)</code> 是在<code>Android 4.4</code>中引入的一个开发者选项， Android 从5.0以后就完全使用了新的虚拟机ART，其与Dalvik有很大的区别。其推出的目的主要是为了提高Android的执行效率，减少卡顿现象。那它是怎么做的呢？ART 采用了一种叫AOT (ahead of time) 来代替目前的在 <code>runtime</code> 时的 Interpreter 与 JIT。ART 不是等到App运行的时候才去运行dex文件，而是在App安装的时候就通过 <strong>AOT编译器</strong> 将<code>.dex</code>文件编译为对应的<code>.oat</code><a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22article%22,%22sourceId%22:95626955%7D">二进制文件</a>，当用户点击App的启动图标时，ART直接加载<code>.oat</code>文件去执行。其中那个<code>.oat</code>文件就是一个**<a href="https://link.zhihu.com/?target=https://baike.baidu.com/item/ELF/7120560">ELF</a>**文件，其是当前机器的可执行的文件了。</p>
<p><code>Android</code> 的运行时从 <code>Dalvik</code>虚拟机替换成 <code>ART</code>虚拟机，并不要求开发者将自己的应用直接编译成目标机器码，<code>APK</code> 仍然是一个包含 <code>dex</code> 字节码的文件。</p>
<p><code>ART</code> 和 <code>Dalvik</code> 都是运行 <code>dex</code>字节码的兼容运行时，因此针对 <code>dalvik</code>开发的应用也能在 <code>ART</code> 环境中运作。</p>
<p><code>dex</code>文件是很多 <code>.class</code>文件通过 <code>DX编译器</code> 处理压缩后的产物，最终可以在 <code>Android</code>运行时环境执行。</p>
<h3 id="Java虚拟机-和-Dalvik虚拟机的区别"><a href="#Java虚拟机-和-Dalvik虚拟机的区别" class="headerlink" title="Java虚拟机 和 Dalvik虚拟机的区别"></a>Java虚拟机 和 Dalvik虚拟机的区别</h3><ol>
<li>运行的字节码不同</li>
</ol>
<p>Java虚拟机运行的是Java字节码，Dalvik虚拟机运行的是Dalvik字节码(可以理解为汇编)。</p>
<p>传统的Java程序经过编译，生成Java字节码并保存在class文件中，Java虚拟机通过解码Class文件内容运行程序；</p>
<p>Dalvik虚拟机运行的Dalvik字节码是由Java字节码转换而来，并被打包到一个DEX可执行文件中(为什么使用JEB反编译DEX文件，就是通过DEX还原源JAVA代码)，Dalvik虚拟机通过解释DEX文件来执行这些字节码。</p>
<ol start="2">
<li>Dalvik可执行文件的体积更小</li>
</ol>
<p>为什么Dalvik可执行文件dex体积更小？<br>在Android SDK中，将Java字节码转换为Dalvik字节码的工具是”dx”。dx能够重新排列Java类文件，消除在类文件中的冗余信息，避免重复加载和解析。</p>
<p>原理是这样子的：<br>Java类中通常有多个方法签名，如果它被调用或者继承，这些签名和方法也会被继承在调用方，所以大量的类包含同样的签名和字符串常量造成冗余。DX把这些常量统一存放在”常量池”中，一个常量只出现一次，供所有类使用，所以DEX文件体积更小。</p>
<ol start="3">
<li>虚拟机架构不同</li>
</ol>
<p>Java虚拟机基于栈架构，运行时指令频繁入栈和出栈，占用大量CPU时间，对于资源有限的设备资源比较吃紧。</p>
<p>而Dalvik是基于寄存器架构的，指令发送给寄存器。直接操作寄存器的汇编语言执行速度是最快的。</p>
<ol start="4">
<li>虚拟机执行流程</li>
</ol>
<p>Dalvik属于Android运行时环境。</p>
<img src="/2021/12/02/Android%E7%AC%94%E8%AE%B0-%E4%B8%80/Dalvik%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B.png" class="" title="Dalvik虚拟机执行流程">

<p>Zygote是所有进程的孵化器，应用程序通过system_server将指令发给Zygote，Zygote为其分配一个单独的进程，并由Dalvik执行。</p>
<p>Dalvik通过loadClassFromDex()装载类。类被解析后变成ClassObject类型的数据结构存储，虚拟机采用gDvm.loadedClass全局散列表(类似map)存储和查询。</p>
<p>字节码验证器使用dvmVerifyCodeFlow()函数对装入的代码进行校验，虚拟机调用FindClass()函数查找并找到main()方法类。最后调用dvmInterpret()函数来初始化解释器并执行字节流。</p>
<ol start="5">
<li>虚拟机执行方式</li>
</ol>
<p>即时编译。</p>
<h2 id="Android系统架构"><a href="#Android系统架构" class="headerlink" title="Android系统架构"></a>Android系统架构</h2><p>Andorid系统架构从上到下分别有应用层、应用框架层、系统运行时库层、硬件抽象层、Linux内核层。</p>
<img src="/2021/12/02/Android%E7%AC%94%E8%AE%B0-%E4%B8%80/Android%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84.jpg" class="" title="Android系统架构">

<ul>
<li><p>应用层：包括系统应用比如闹钟、日历等这些在内的以及非系统级别的应用都属于应用层。负责用户交互，也就是我们需要开发的东西。</p>
</li>
<li><p>应用框架层：这一层主要是为咱们开发人员提供用来开发应用程序的API，平常我们开发程序大部分都是调用这部分的API来进行开发。这一层主要提供一些ActivityManager 管理应用生命周期、locationManager 地理位置服务、还有就是NotificationManager 消息通知管理等等</p>
</li>
<li><p>系统运行库层：这一层主要分为两部分，分别是c/c++程序库和Android运行库</p>
<p><strong>c++库：</strong>主要是能被Andorid系统不同组件所使用，并通过应用程序框架为开发者提供服务。它主要功能有openggl 绘图方法库，多媒体库支持常用的音频 视频格式录制回访 ，还有我们常用会用到的一个轻量级的数据库 sqlLite 等还有ssl网络协议等等</p>
<p><strong>Android运行时库：</strong>它主要又分为核心库和虚拟机ART，核心库主要包含Java核心库的大部分功能。Android 5.0系统之前使用的虚拟机是 dalvik，它相对于JVM来说，dalvik虚拟机是专门为移动设备定制的，主要在有限的内存中同时运行多个虚拟机实例，每一个dalvik虚拟机就是一个独立的linux进程，这样独立的进程可以防止在虚拟机崩溃的时候所有程序都被关闭。  5.0之后，dalvik虚拟机被ART所取代，它们主要区别就是dalvik虚拟机，应用每次在运行的时候，都需要把字节码文件转换为机器码来运行，这样应用的运行效率就会比较低。  而ART虚拟机，应用在第一次安装的时候，字节码文件就会预先编译成机器码，让应用成为真正的本地应用。</p>
</li>
<li><p>硬件抽象层：它是位于操作系统内核和硬件电路之间的接口层，主要目的在于将硬件抽象化，隐藏了特定平台的硬件接口细节，为操作系统提供虚拟硬件平台，使其具有硬件无关性，可在多平台上进行移植。</p>
</li>
<li><p>linux内核层：Android的核心系统服务基于Linux内核，在此基础上添加了部分Android专用的驱动，android系统的安全管理、内存管理、进程管理、网络协议等都依赖于该内核。</p>
</li>
</ul>
<h2 id="Android-编译流程"><a href="#Android-编译流程" class="headerlink" title="Android 编译流程"></a>Android 编译流程</h2><p>一个App从源代码到 <code>.apk</code> 安装文件都经历了哪些过程呢？</p>
<p>下图非常清楚的描述了这一过程： </p>
<img src="/2021/12/02/Android%E7%AC%94%E8%AE%B0-%E4%B8%80/Android%E7%BC%96%E8%AF%91%E6%B5%81%E7%A8%8B.jpg" class="" title="Android编译流程">

<ol>
<li><p>通过AAPT(Android Assets Packing Tool) 编译资源文件，将资源文件打包编译并生成生成<strong>R.java</strong>文件，就是放各种资源Id的那个文件。 </p>
</li>
<li><p>通过Java编译器<strong>javac</strong>将 <code>.java</code> 源代码文件编译为 <code>.class</code> 字节码文件 </p>
</li>
<li><p>通过Dalvik 编译器 将 <code>.class</code> 文件转化为 <code>.dex</code> 文件</p>
</li>
<li><p>通过Apk builder 将打包后的资源与 <code>.dex</code> 文件一起生成APK文件。</p>
</li>
</ol>
<h2 id="Android系统的启动流程"><a href="#Android系统的启动流程" class="headerlink" title="Android系统的启动流程"></a>Android系统的启动流程</h2><img src="/2021/12/02/Android%E7%AC%94%E8%AE%B0-%E4%B8%80/Android%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B1.png" class="" title="Android系统启动流程1">

<img src="/2021/12/02/Android%E7%AC%94%E8%AE%B0-%E4%B8%80/Android%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B2.png" class="" title="系统启动流程2">

<ol>
<li><p>启动电源以及系统启动<br> 加载引导程序Bootloader到RAM，然后执行。</p>
</li>
<li><p>引导程序BootLoader启动<br> 引导程序BootLoader是在Android操作系统开始运行前的一个小程序，它的主要作用是把系统OS拉起来并运行。</p>
</li>
<li><p>Linux内核启动<br> 内核启动时，设置缓存、被保护存储器、计划列表、加载驱动。当内核完成系统设置，它首先在系统文件中寻找init.rc文件，并启动init进程。</p>
</li>
<li><p>init进程启动<br> init进程是系统空间内的第一个进程，进行初始化和启动属性服务，在main方法中进行，包括初始化资源文件和启动一系列的属性服务。通过执行init.rc文件的脚本文件来启动Zygote进程。</p>
</li>
<li><p>Zygote进程启动<br> 所有的应用程序包括system系统进程 都是zygote进程负责创建，因此zygote进程也被称为进程孵化器，它创建进程是通过复制自身来创建应用进程，它在启动过程中会在内部创建一个虚拟机实例，所以通过复制zygote进程而得到的应用进程和系统服务进程都可以快速地在内部的获得一个虚拟机实例拷贝。</p>
</li>
<li><p>SystemServer进程启动<br> 启动Binder线程池和SystemServiceManager，systemServiceManger主要是对系统服务进行创建、启动和生命周期管理，就会启动各种系统服务。（android中最核心的服务AMS就是在SystemServer进程中启动的）</p>
</li>
<li><p>Launcher启动<br> Launcher组件是由之前启动的systemServer所启动的<br> 这也是andorid系统启动的最后一步，launcher是andorid系统home程序，主要是用来显示系统中已安装的应用程序。    launcher应用程序的启动会通过请求packageManagerService返回系统中已经安装的应用信息，并将这些应用信息通过封装处理成快捷列表显示在系统屏幕上，这样咱们就可以单击启动它们。<br> 被SystemServer进程启动的ActivityManagerService会启动Launcher，Launcher启动后会将已安装应用的快捷图标显示到界面上。</p>
</li>
</ol>
<p>上述七步是手机开机andorid系统启动的流程。</p>
<h2 id="Android-程序执行流程"><a href="#Android-程序执行流程" class="headerlink" title="Android 程序执行流程"></a>Android 程序执行流程</h2><p>现代虚拟机一般有两种执行方式，根据具体的使用场景各有侧重。</p>
<img src="/2021/12/02/Android%E7%AC%94%E8%AE%B0-%E4%B8%80/JVM%E6%89%A7%E8%A1%8C%E5%AD%97%E8%8A%82%E7%A0%81%E7%AD%96%E7%95%A5.jpg" class="" title="JVM执行字节码策略">

<p><strong>Interpreter</strong> ：解释执行。一边把字节码翻译成当前硬件平台的机器码一边执行。优点是启动快，缺点就是执行效率太低下了。Interpreter 对应的编译器称为<strong>解释执行编译器</strong>。</p>
<p><strong>JIT（Just In Time）</strong> ：即时编译。当一些代码被频繁执行到时，虚拟机就将其编译成机器码。这些被频繁执行的代码有个专有名词：“<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E7%83%AD%E7%82%B9%E4%BB%A3%E7%A0%81&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22article%22,%22sourceId%22:95626955%7D">热点代码</a>” ，相信大家最熟悉的JVM就是sun公司的的虚拟机<strong>HotSpot</strong>，其也是因为热点探测技术比较牛逼而得名。JIT 对应的编译器为<strong>即时编译器</strong>。</p>
<h3 id="Dalvik-虚拟机启动App流程"><a href="#Dalvik-虚拟机启动App流程" class="headerlink" title="Dalvik 虚拟机启动App流程"></a>Dalvik 虚拟机启动App流程</h3><img src="/2021/12/02/Android%E7%AC%94%E8%AE%B0-%E4%B8%80/Dalvik%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%90%AF%E5%8A%A8App%E6%B5%81%E7%A8%8B.jpg" class="" title="Dalvik虚拟机启动App流程">

<p>如上图所示，在Dalvik虚拟机上首次启动App一定是使用Interpreter解释执行的，期间会探测热点代码，使用JIT编译执行，如果我没记错的话，JIT应该是在Android2.2之后加入的，可见最早期的Android很缓慢。</p>
<h3 id="ART-安装及启动App流程"><a href="#ART-安装及启动App流程" class="headerlink" title="ART 安装及启动App流程"></a>ART 安装及启动App流程</h3><p>前面说过，ART是在App安装的时候将 <code>.apk</code> 文件减压，并将 <code>.dex</code> 文件预编译为 <code>.oat</code> 可执行文件，当App启动的时候就不需要在Runtime解释执行了，但是这种方式也有它自己的缺点。</p>
<ol>
<li>增加了App的安装时间，这个很容易理解，因为多了一个预编译过程。</li>
<li>增加了App所需要的安装空间，与Dalvik相比，手机上多了一份 <code>.oat</code> 文件。特别是无论一个App的某一功能是否被使用到以及被使用的频率，例如一个App的某个功能，用户几乎不会去打开，ART都将其编译为<code>.oat</code>文件就显得有点低效了。</li>
</ol>
<p>Google的那些天才工程师既然发现了问题，那肯定就会去想办法优化的。技术的每一次进步，都是站在前面技术的肩膀上的，这一次也不例外，Google的工程师将<strong>Interpreter</strong>,<strong>JIT</strong>与<strong>AOT</strong> 三种技术相结合来优化这个过程。</p>
<ol>
<li>当你首次安装并一个App的时候，AOT不将 <code>.dex</code> 文件编译为 <code>.oat</code> 文件，这一步减少了安装时间。系统通过<strong>Interpreter</strong>的方式来启动App.</li>
<li>当在App运行过程中探测到了热点代码”hot code”，就使用JIT编译</li>
<li>这些通过JT编译的 <a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E5%B9%B3%E5%8F%B0%E4%BB%A3%E7%A0%81&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22article%22,%22sourceId%22:95626955%7D">平台代码</a> 及编译配置文件都会被存储在缓存中，加快下次访问的速度</li>
</ol>
<p>当设备处于空闲时间时，AOT 编译器就会启动，结合编译配置文件将热点代码编译为 <code>.oat</code> 可执行文件</p>
<p>当再次运行App时，ART就可以直接运行 <code>.oat</code> 文件了</p>
<p><strong>PS:  Android 虚拟机是不能直接执行 <code>.class</code> 文件的，而其只能执行 <code>.dex</code> 文件，所以就必须有一个将Java字节码 <code>.class</code> 文件转化为Dalvik字节码 <code>.dex</code> 文件的的编译器  —— DX编译器（其中一个）</strong></p>
<h2 id="应用进程启动流程"><a href="#应用进程启动流程" class="headerlink" title="应用进程启动流程"></a>应用进程启动流程</h2><p>首先，activity分为两种分别是根activity和子activity，根activity就是显示在手机屏幕上快捷应用图标，在launcher应用程序启动器，根activity也就是app的第一个activity是由Launcher组件来启动，但它又是通过activity管理服务ActivityManagerService来启动根activity。但是activity Launcher activityManagerService分别运行在不同进程里面，这三个进程是通过binder进程间通信机制来完成进行通信完成activity的启动。应用的启动也就是根activity的启动。</p>
<p>ActivityManagerService 是一个系统关键服务，运行在systemService系统进程中，负责启动和调度应用程序组件。</p>
<p>luncher是andorid系统的home程序，管理和安装手机里的所有应用</p>
<p>时序图如下：</p>
<img src="/2021/12/02/Android%E7%AC%94%E8%AE%B0-%E4%B8%80/%E5%BA%94%E7%94%A8%E8%BF%9B%E7%A8%8B%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B-%E6%97%B6%E5%BA%8F%E5%9B%BE.png" class="" title="应用进程启动流程-时序图">

<p>应用进程启动流程详情图如下：</p>
<img src="/2021/12/02/Android%E7%AC%94%E8%AE%B0-%E4%B8%80/%E5%BA%94%E7%94%A8%E8%BF%9B%E7%A8%8B%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E8%AF%A6%E5%9B%BE.png" class="" title="应用进程启动流程详图">

<p>（1）Launcher首先向activityManagerService发送一个启动activity的进程间通信请求</p>
<p>（2）ams会先把要启动的activity信息保存下来，然后再想Launcher发送一个进入中止状态的进程间通信请求。</p>
<p>（3）Launcher组件进入终止状态后，就会给ams发送一个已进入终止状态的一个进程间通信请求，ams收到后就会继续执行启动activity操作</p>
<p>（4）ams如果发现用来运行运行activity的进程不存在，它就会给zygote进程发送一个进程间通信请求，zaygote会调用fork（）方法创建一个新的应用程序进程。zaygote进程在启动的时候在内部创建一个虚拟机实例，它通过复制它本身得到一个应用程序进程。</p>
<p>（5）新的应用程序进程启动完成之后，就会向ams发送一个启动完成的通信请求，</p>
<p>（6）进程创建好之后，经过一系列调用就会调用startactivity方法，最后     activity调用oncreate方法构建出页面至此我们的应用正式启动完成。</p>
<p>TODO：</p>
<ul>
<li><input disabled="" type="checkbox"> IPC原理</li>
<li><input disabled="" type="checkbox"> AMS服务</li>
<li><input disabled="" type="checkbox"> Binder进程</li>
<li><input disabled="" type="checkbox"> Launcher组件（Android的各个组件）</li>
<li><input disabled="" type="checkbox"> zaygote进程 </li>
<li><input disabled="" type="checkbox"> JNI</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/95626955">深入理解Android虚拟机及编译系统</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/5ed975c9801f">AMS服务简介、Android系统启动流程、应用进程启动流程</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6850418121287663630">学习笔记-Android虚拟机与类加载机制</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/4e36e7daa84d">Android系统启动流程和App启动流程</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/11/22/%E5%B0%8F%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="一叶">
      <meta itemprop="description" content="当你下定决心做一件事的时候，全世界都会来帮你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一叶的小窝">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/11/22/%E5%B0%8F%E8%AE%B0/" class="post-title-link" itemprop="url">小记</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-11-22 20:15:38" itemprop="dateCreated datePublished" datetime="2021-11-22T20:15:38+08:00">2021-11-22</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-12-04 21:52:06" itemprop="dateModified" datetime="2021-12-04T21:52:06+08:00">2021-12-04</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E9%9A%8F%E7%AC%94/" itemprop="url" rel="index"><span itemprop="name">随笔</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>历时4个月的实习结束，很久没有更新博客了，没错是实习太忙了（好吧我摊牌了，我是懒🐕），简单整理一下心得及近期计划。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/11/22/%E5%B0%8F%E8%AE%B0/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/15/%E5%88%9D%E6%8E%A2%E8%BF%9C%E6%8E%A7%E6%9C%A8%E9%A9%AC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="一叶">
      <meta itemprop="description" content="当你下定决心做一件事的时候，全世界都会来帮你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一叶的小窝">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/05/15/%E5%88%9D%E6%8E%A2%E8%BF%9C%E6%8E%A7%E6%9C%A8%E9%A9%AC/" class="post-title-link" itemprop="url">初探远控c&c</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-05-15 10:30:17" itemprop="dateCreated datePublished" datetime="2021-05-15T10:30:17+08:00">2021-05-15</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-27 17:34:35" itemprop="dateModified" datetime="2021-05-27T17:34:35+08:00">2021-05-27</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8F%8D%E7%97%85%E6%AF%92/" itemprop="url" rel="index"><span itemprop="name">反病毒</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>如有不足（错误），请多指正。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/05/15/%E5%88%9D%E6%8E%A2%E8%BF%9C%E6%8E%A7%E6%9C%A8%E9%A9%AC/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/30/Dll%E6%B3%A8%E5%85%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="一叶">
      <meta itemprop="description" content="当你下定决心做一件事的时候，全世界都会来帮你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一叶的小窝">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/30/Dll%E6%B3%A8%E5%85%A5/" class="post-title-link" itemprop="url">DLL注入之远程线程注入（一）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-04-30 12:31:43" itemprop="dateCreated datePublished" datetime="2021-04-30T12:31:43+08:00">2021-04-30</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-18 20:57:12" itemprop="dateModified" datetime="2021-05-18T20:57:12+08:00">2021-05-18</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DLL%E6%B3%A8%E5%85%A5/" itemprop="url" rel="index"><span itemprop="name">DLL注入</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>DLL注入的目的是使另一个进程加载一个DLL文件来改变其正常流程，通常用来实现该程序的作者本未设计或预期的结果。</p>
<p>常应用于拓展程序功能、当然这也非常受外挂、病毒、木马的青睐。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/04/30/Dll%E6%B3%A8%E5%85%A5/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/20/hello-worl/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="一叶">
      <meta itemprop="description" content="当你下定决心做一件事的时候，全世界都会来帮你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一叶的小窝">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/20/hello-worl/" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-04-20 17:07:48" itemprop="dateCreated datePublished" datetime="2021-04-20T17:07:48+08:00">2021-04-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-05-01 10:40:06" itemprop="dateModified" datetime="2021-05-01T10:40:06+08:00">2021-05-01</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>!
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/04/20/hello-worl/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




<script src="/js/comments.js"></script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">一叶</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
